# Package Manager

### 패키지 매니저의 필요성

- 다른 사람이 만들어서 공개한 도구를 갖고와서 사용하거나, 내가 필요로하는 라이브러리가 이미 다른 누군가 작성한 코드로 제공되고 있을 때, 나의 프로젝트로 가져올 수 있게 하는 도구
- 나의 프로젝트로 가지고 오는 설치 과정
- 프로젝트에 무엇이 필요한지 기록해서 관리하는 과정
- 기본 패키지 매니저는 Node.js 를 설치할 때 함께 설치 되는 **npm**

## 패키지 매니저 종류

### npm

- 사람들은 기본 설치된 npm 을 이용
- npm 저장소에 npm 패키지를 만들어 Publish
- 나의 프로젝트에 패키지를 설치하고 정의
- 사소한 문제들이 있었지만, 큰 문제가 아니라고 생각하고 다들 잘 이용하고 있었다. (사소하지 않았음)

#### npm workspace

- npm v7 부터 사용 가능
- 단일 최상위 루트 패키지 내에서 로컬 파일 시스템의 여러 패키지를 관리할 수 있도록 지원하는 npm cli 의 기능 집합을 지칭하는 일반적인 용어
- npm link 를 수동으로 사용할 필요가 없음
- package.json 파일의 workspaces 속성을 통해 정의
- 선언적으로 정의된 속성을 이용하여, npm install 으로 자동 npm link 처리

### yarn classic

- npm 의 동작방식을 그대로 가져가면서 아쉬운 부분들을 해결하고자 Facebook, Google 등이 함께 만든 yarn 이 출시
- Lock 파일이라는 개념을 도입해서 일관적으로 의존성을 재설치
- 보안도 향상
- 병렬 설치로 성능을 향상
- 워크스페이스 기능을 도입 (_npm 도 v7 이상부터는 도입됨_)

#### yarn 1.x workspaces

- 시기상으로 yarn 의 workspaces 기능이 npm 의 workspaces 기능보다 먼저 출시
- yarn 1.0 부터 기본적으로 사용이 가능
- npm link 와 마찬가지로 yarn link 를 대신하여 선언적으로 사용
- package.json 파일의 workspaces 속성을 통해 정의 (=npm)
- 프로젝트 내의 모든 패키지의 의존성이 함께 설치되고 관리되어 충돌이 적고, 최적화에 유리
- 최종적으로 npm 과 같은 방식이기 때문에 같은 한계를 가짐
- Yarn 1.x 에서는 루트 프로젝트에 private: true 가 설정되어 있어야 함

> #### Phantom Dependency
>
> - **npm & yarn classic** 모두 node_modules 의 구조가 플랫하기 때문에 내가 설치하지 않은 의존성을 사용할 수 있다.
> - 이로 인해 많은 위험이 있을 수 있고, 현재도 이 리스크는 가지고 있다.

### yarn berry

- Yarn 의 첫번째 버전과 다른 완전히 새로운 버전이 2020년에 출시
- node_modules 를 사용하지 않고 압축파일을 사용하는 완전히 새로운 개념을 사용
  - 이를 통해서 **설치 시간을 최소화**하고 설치하지 않아도 사용 가능한 개념(**_Zero Install_**)을 선보입니다.
- 엄격한 의존 관계로 인해 팬텀 디펜던시와 같은 문제가 발생하지 않는다.
- 워크스페이스 기능은 계속 존재

#### yarn berry workspaces

- yarn berry 는 yarn 의 두번째 버전이고, 2.x 부터 시작하여 현재 4.x
- 기본적으로 명시적인 의존 관계를 나타내야 사용이 가능
- node*modules 에 패키지를 저장하는 방식이 아니라 패키지를 압축하여 한개의 파일을 .yarn/cache 폴더에 수평적으로 저장(\_Plug’n’Play(PnP)*)
  - 수평적으로 존재하기 때문에 빠르게 찾을 수 있음
  - 압축파일을 설치하기 때문에 파일 개수가 감소하여 설치가 빠름.
  - Zero Install 을 이용하여, 저장소에서 함께 관리할 수도 있음
  - 팬텀 디펜던시가 발생하지 않음

#### yarn berry workspaces 아쉬움

- Plug’n’Play(PnP) 는 기존의 패키지 관리 방식과는 다르기 때문에 어색한 요소들이 존재
- IDE 에서 직접 사용하는 많은 도구들을 SDK 를 통해 우회 호출할 수 있도록 추가적인 설정이 필요
- Install 이 항상 빠른 것은 아님
- Zero Install 을 이용하여 압축파일들을 가지고 작업하면, 저장소 자체가 매우 커질 수 있음
- Zero Install 이라고 정말 설치하지 않는 것은 아님

### pnpm

- 기존에 패키지 매니저에 실망감을 가지고 있는 개발자가 pnpm 을 출시
- 하드 링크와 소프트 링크를 적절히 사용해서 성능 향상과 디스크 효율성을 강조
- npm v3 의 플랫한 구조를 버리고 중첩 구조를 유지하면서 문제를 해결
- 워크스페이스 기능을 가짐

#### pnpm workspaces

- 빠르고, 효율적인 패키지 매니저
- 모노레포를 지원하고, 평탄하지 않은 node_modules 가 기본이기 때문에 엄격한 의존 관리가 가능
- 시스템 내에 단일 패키지 스토어에 모든 의존성을 보관하기 때문에 디스크 공간 절약
- 필요한 의존성을 식별하여 스토어로 가져오고, 디렉토리 구조를 계산하여 하드 링크하는 과정을 가지기 때문에 설치 속도가 빠름
- 기본적으로, pnpm 은 symlink 를 사용하여 프로젝트의 직접적인 의존성만을 모듈 디렉토리의 루트로 추가
