# Module Federation 기술에 적용에 대해..

## 기본 설정

### Host React 앱에서 다른 서버의 Remote React 컴포넌트를 런타임에 가져와서 사용

- **_create-mf-app_** 을 이용하면 쉽게 기본 설정의 module federation app 생성 가능
- ModuleFederationPlugin 의 설정이 매우 **중요**
  - `name`, `filename`, `exposes` 의 key 를 이용해서 코드를 런타임에 다른 앱에게 전달
  - `remotes` 의 키는 내부에서 사용하며, 값으로 외부의 정보를 정확히 기입
  - `remotes` 의 키와 `exposes` 의 키를 조합하며, 소스 코드에서 다른 서버의 소스 코드를 사용

### 여러 마이크로 앱에서 런타임에 공통적으로 사용하는 라이브러리를 한번만 로드

- 마이크로 앱이 런타임에 사용하는 여러 라이브러리를 _어떻게 공유해서 쓸 것인지_ 에 대한 설정 가능
- **shared** 항목을 지정해서 설정하는데 사용 방법
  - `['lodash']` 와 같이 라이브러리 이름을 배열로 넣으면, `package.json` 에 있는 버전으로 함께 공유해서 사용할 라이브러리의 기준이 정해짐
  - `{lodash: '4.17.21'}` 와 같이 키가 라이브러리 이름이고 값이 버전으로 지정하면 `package.json`과 관계없이 함께 공유해서 사용할 라이브러리의 기준을 정할 수 있음
  - `{lodash: { requiredVersion: '4.17.20', singleton: true, strictVersion: true}}` 와 같이 키가 라이브러리 이름 값이 객체 형태로 지정할 수 있으며, **singleton** 과 같은 플래그를 이용해서 디테일한 공유 설정 가능

### 두 앱에서 Context 를 공유해서 사용

- React 의 context 를 공유하려면, 같은 React 를 공유해서 사용
- 프로젝트 내에 공유할 패키지를 만들고 빌드 후 마이크로 앱들이 사용할 때, `workspace:*` 버저닝이 문제가 될 수 있음
- 프로젝트 내에 공유할 패키지는 shared 의 버전 정책이 운영의 정책과 긴밀한 관련이 있음

### Lazy, Suspense, ErrorBoundary 를 통한 통합

- 모듈 페더레이션을 통해 가져오는 코드 조각은 서버가 다르기 때문에 일반적으로 지연 로딩을 이용해서 가져옴
- 이렇게 `React.lazy` 를 이용하는 경우 컴포넌트가 로드되기 전까지 표현을 위해 `React.Suspense` 를 이용해서 표현
- 어떤 이유로든 지연 로딩을 하다가 문제가 발생한 경우에 대한 처리를 위해 react 의 `error boundary` 기법을 이용하며, 해당 컴포넌트의 에러를 격리해서 장애가 퍼지지 않도록 해야함
- 지연 로딩, 지연 UI, 에러 격리, 에러 UI 는 마이크로 프론트엔드에서 필수적이며, 반드시 처리가 필요
